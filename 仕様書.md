# æ¥½å¤©å¸‚å ´ å•†å“å¯è¦–åŒ– WebUI

**å®Œå…¨ä»•æ§˜æ›¸ï¼ˆå®Ÿè£…è€…å‘ã‘ãƒ»æœ€çµ‚ç‰ˆï¼‰**

---

## 0. ã“ã®è³‡æ–™ã®ä½ç½®ã¥ã‘

æœ¬ä»•æ§˜æ›¸ã¯ã€ä»¥ä¸‹ã‚’**ã™ã¹ã¦åŒ…å«**ã™ã‚‹ã€‚

* èƒŒæ™¯ãƒ»èª²é¡Œãƒ»ç›®çš„
* å…ƒãƒ‡ãƒ¼ã‚¿ã®æ€§è³ªã¨æ³¨æ„ç‚¹
* ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆæ€æƒ³ï¼ˆç²’åº¦ãƒ»é›†ç´„ãƒ«ãƒ¼ãƒ«ï¼‰
* ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹æˆ
* GASã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆä»•æ§˜
* WebUIãŒå‚ç…§ã™ã¹ããƒ‡ãƒ¼ã‚¿æ§‹é€ 
* ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹å®šç¾©
* åˆ©ç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®æ•°å¼ä»•æ§˜
* å°†æ¥æ‹¡å¼µã‚’å‰æã¨ã—ãŸè¨­è¨ˆåˆ¤æ–­

ğŸ‘‰ **å®Ÿè£…æ‹…å½“è€…ã¯ã€è¿½åŠ è³ªå•ãªã—ã§é–‹ç™ºã‚’é–‹å§‹ã§ãã‚‹çŠ¶æ…‹ã‚’ã‚´ãƒ¼ãƒ«ã¨ã™ã‚‹**

---

## 1. èƒŒæ™¯ã¨èª²é¡Œ

### 1.1 èƒŒæ™¯

* æ¥½å¤©å¸‚å ´åº—èˆ—ã§ã¯ã€Œå•†å“ä¸€å…ƒç®¡ç†ã‚·ãƒ¼ãƒˆã€ã«ã€

  * åœ¨åº«
  * å£²ä¸Š
  * åˆ©ç›Š
  * ã‚¢ã‚¯ã‚»ã‚¹
  * è»¢æ›ç‡
  * æ–°è¦/ãƒªãƒ”ãƒ¼ãƒˆ
  * ãƒ¬ãƒ“ãƒ¥ãƒ¼
    ãªã© **éå¸¸ã«æœ‰ç”¨ãªãƒ‡ãƒ¼ã‚¿ãŒæƒã£ã¦ã„ã‚‹**

* ã—ã‹ã—ç¾çŠ¶ã¯

  * è¡Œæ•°ãŒå¤šã„
  * SKUç²’åº¦ã¨å•†å“ç²’åº¦ãŒæ··åœ¨
  * æ•°å€¤ãŒä¸¦ã¶ã ã‘ã§ã€Œåˆ¤æ–­ã€ãŒã—ã¥ã‚‰ã„
    ã¨ã„ã†ç†ç”±ã‹ã‚‰ã€**äººé–“ãŒæ„æ€æ±ºå®šã™ã‚‹ã«ã¯å¯è¦–æ€§ãŒä½ã„**

### 1.2 è§£æ±ºã—ãŸã„èª²é¡Œ

1. **æ—¥å¸¸é‹ç”¨ã§ç¬æ™‚ã«çŠ¶æ³åˆ¤æ–­ã§ããªã„**
2. **æ¬ å“ã‚„èµ¤å­—ãªã©ã®é‡å¤§å•é¡Œã‚’è¦‹è½ã¨ã—ã‚„ã™ã„**
3. **å…ˆæœˆã¨ä»Šæœˆã®å¤‰åŒ–ãŒç›´æ„Ÿçš„ã«åˆ†ã‹ã‚‰ãªã„**
4. **å•†å“ã”ã¨ã®åˆ¤æ–­ãƒ¡ãƒ¢ãŒè“„ç©ã•ã‚Œãªã„**
5. **ä¾¡æ ¼ãƒ»ãƒã‚¤ãƒ³ãƒˆãƒ»é€æ–™ã‚’å¤‰ãˆãŸã¨ãã®åˆ©ç›ŠãŒå³åº§ã«åˆ†ã‹ã‚‰ãªã„**

---

## 2. ç›®çš„ï¼ˆã“ã®WebUIã§é”æˆã™ã‚‹ã“ã¨ï¼‰

### 2.1 æ©Ÿèƒ½é¢ã®ç›®çš„

* å•†å“ã”ã¨ã®çŠ¶æ…‹ã‚’ **ä¸€ç›®ã§æŠŠæ¡**
* å•é¡Œå•†å“ã‚’ **ãƒãƒƒã‚¸ã§å³ç™ºè¦‹**
* å…ˆæœˆ vs ä»Šæœˆã®å¤‰åŒ–ã‚’ **è¦–è¦šçš„ã«æ¯”è¼ƒ**
* å•†å“è©•ä¾¡ãƒ»ãƒ¡ãƒ¢ã‚’ **é‹ç”¨çŸ¥ã¨ã—ã¦è“„ç©**
* åˆ©ç›Šæ§‹é€ ã‚’ **ãã®å ´ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**

### 2.2 ãƒ“ã‚¸ãƒã‚¹é¢ã®ç›®çš„

* æ¬ å“ã«ã‚ˆã‚‹ **æ©Ÿä¼šæå¤±ã®æœ€å°åŒ–**
* èµ¤å­—å•†å“ã® **æ—©æœŸç™ºè¦‹ãƒ»æ˜¯æ­£**
* CVæ‚ªåŒ–å•†å“ã® **æ”¹å–„åˆ¤æ–­**
* åˆ©ç›ŠãŒå‡ºã‚‹å•†å“ã® **è‚²æˆåˆ¤æ–­**

---

## 3. å…ƒãƒ‡ãƒ¼ã‚¿ï¼ˆå•†å“ä¸€å…ƒç®¡ç†ã‚·ãƒ¼ãƒˆï¼‰ã®æ€§è³ªã¨æ³¨æ„ç‚¹

### 3.1 å…ƒãƒ‡ãƒ¼ã‚¿ã®ç²’åº¦

* **1è¡Œ = SKUè¡Œ**
* åŒä¸€ã€Œå•†å“ç®¡ç†ç•ªå·ã€ã«å¯¾ã—ã¦è¤‡æ•°SKUãŒå­˜åœ¨ã™ã‚‹

### 3.2 é‡è¦ãªç™–ï¼ˆè¨­è¨ˆã«ç›´çµï¼‰

#### â‘  ã‚¢ã‚¯ã‚»ã‚¹ç³»ãƒ‡ãƒ¼ã‚¿ã¯ SKU ã«è¤‡è£½ã•ã‚Œã¦ã„ã‚‹

* ä»Šæœˆã‚¢ã‚¯ã‚»ã‚¹äººæ•°
* è»¢æ›ç‡
* æ»åœ¨æ™‚é–“
* é›¢è„±ç‡
* ãŠæ°—ã«å…¥ã‚Šæ•°

ğŸ‘‰ **SKUã”ã¨ã«ç•°ãªã‚‹å€¤ã§ã¯ãªã„**
ğŸ‘‰ SKUç²’åº¦ã§è¦‹ã‚‹ã¨ã€Œé‡è¤‡ã—ã¦è¦‹ãˆã‚‹ã€

#### â‘¡ å£²ä¸Šãƒ»åœ¨åº«ãƒ»åˆ©ç›Šã¯ SKU åˆ¥ã«æ­£ã—ãé›†è¨ˆã•ã‚Œã¦ã„ã‚‹

* å£²ä¸Šå€‹æ•°
* å£²ä¸Šé‡‘é¡
* åˆ©ç›Š
* åœ¨åº«æ•°

ğŸ‘‰ SKUåˆç®—ã™ã‚Œã° **å•†å“å…¨ä½“ã®æ­£ã—ã„æ•°å€¤**ã«ãªã‚‹

---

## 4. ç²’åº¦è¨­è¨ˆã®æ€æƒ³ï¼ˆæœ€é‡è¦ï¼‰

### 4.1 ãªãœã€Œå•†å“ç®¡ç†ç•ªå·é›†ç´„ã€ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãªã®ã‹

* äººãŒåˆ¤æ–­ã™ã‚‹å˜ä½ã¯ **SKUã§ã¯ãªãå•†å“**
* ã‚¢ã‚¯ã‚»ã‚¹ç³»ã¯å•†å“å˜ä½ã§è¦‹ã‚‹ã¹ã
* SKUç²’åº¦ã§ä¸€è¦§ã‚’ä½œã‚‹ã¨

  * è¡Œæ•°ãŒå¢—ãˆã‚‹
  * ã‚¢ã‚¯ã‚»ã‚¹ãŒæ°´å¢—ã—ã«è¦‹ãˆã‚‹
  * åˆ¤æ–­ãŒãƒ–ãƒ¬ã‚‹

ğŸ‘‰ **ä¸€è¦§ = å•†å“ç²’åº¦**
ğŸ‘‰ **SKUç²’åº¦ = è©³ç´°ç”»é¢ã®å†…è¨³**

---

## 5. å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•†å“ä¸€å…ƒç®¡ç†ã‚·ãƒ¼ãƒˆï¼ˆrawï¼‰ â”‚ â† RMS/TSVè²¼ã‚Šä»˜ã‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ GASï¼ˆé›†ç´„ãƒ»æ­£è¦åŒ–ï¼‰
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ webui_products_cache â”‚ â† ä¸€è¦§ãƒ»è©³ç´°ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ webui_skus_cache     â”‚ â† SKUå†…è¨³ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ product_notes        â”‚ â† è©•ä¾¡ãƒ»ãƒ¡ãƒ¢ï¼ˆç·¨é›†ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ settings             â”‚ â† é€æ–™ãƒ»é–¾å€¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–²
          â”‚ WebUIï¼ˆå‚ç…§ãƒ»æ›´æ–°ï¼‰
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       WebUI           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹æˆï¼ˆå®Œå…¨å®šç¾©ï¼‰

### 6.1 å•†å“ä¸€å…ƒç®¡ç†ï¼ˆrawï¼‰

* æ—¢å­˜ã‚·ãƒ¼ãƒˆ
* WebUIã¯ **ç›´æ¥å‚ç…§ã—ãªã„**
* ç²’åº¦æ··åœ¨ãƒ»æ–‡å­—åˆ—æ··å…¥ãŒã‚ã‚‹ãŸã‚

---

### 6.2 webui_products_cacheï¼ˆProducté›†ç´„ï¼‰

> **ä¸€è¦§ãƒ»è©³ç´°ã®å”¯ä¸€ã®å‚ç…§å…ƒ**

#### ä¸»ã‚­ãƒ¼

* `product_code`ï¼ˆå•†å“ç®¡ç†ç•ªå·ï¼‰

#### åˆ—å®šç¾©ï¼ˆå®Œå…¨ï¼‰

ï¼ˆâ€»ã“ã“ã¯å®Ÿè£…è€…ãŒãã®ã¾ã¾ãƒ˜ãƒƒãƒ€ã‚’ä½œã‚Œã‚‹ã‚ˆã†ã« **å…¨åˆ—å¿…é ˆ**ï¼‰

* product_code
* product_name
* representative_sku
* sku_count
* oos_sku_count
* shipping_type_mode
* rating
* memo
* note_updated_at
* stock_sum
* sales_units_m
* sales_units_lm
* sales_amount_m
* sales_amount_lm
* profit_m
* profit_lm
* access_m
* access_lm
* cv_m
* cv_lm
* bounce_m
* bounce_lm
* stay_m
* stay_lm
* fav_add_m
* fav_add_lm
* fav_total
* orders_total_m
* orders_total_lm
* orders_new_m
* orders_new_lm
* orders_rep_m
* orders_rep_lm
* reviews_post_m
* reviews_post_lm
* reviews_total
* min_setting_margin
* max_setting_margin
* min_setting_unit_profit
* access_diff
* cv_diff
* sales_units_diff
* profit_diff
* new_ratio_m
* rep_ratio_m
* badgesï¼ˆJSONæ–‡å­—åˆ—ï¼‰

---

### 6.3 webui_skus_cacheï¼ˆSKUå†…è¨³ï¼‰

* product_code
* sku_code
* shipping_type
* cost_ex_tax
* stock
* stock0_days
* price_in_tax
* sales_units_m
* sales_units_lm
* sales_amount_m
* profit_m
* setting_unit_profit
* setting_margin
* updated_at

---

### 6.4 product_notesï¼ˆç·¨é›†æ°¸ç¶šï¼‰

* product_codeï¼ˆPKï¼‰
* rating
* memo
* updated_at

â€» rawæ›´æ–°ãƒ»cacheå†ç”Ÿæˆã®å½±éŸ¿ã‚’å—ã‘ãªã„

---

### 6.5 settings

#### é€æ–™ãƒ†ãƒ¼ãƒ–ãƒ«

* shipping_type
* shipping_cost_in_tax

#### åˆ©ç›Šè¨ˆç®—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

* tax_rateï¼ˆ0.1ï¼‰
* fee_rateï¼ˆ0.07ï¼‰
* default_point_rateï¼ˆ0.01ï¼‰

#### ãƒãƒƒã‚¸é–¾å€¤ï¼ˆJSONï¼‰

* low_stock_threshold
* access_top_percent
* low_margin_threshold
  ãªã©

---

## 7. Producté›†ç´„ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Ÿè£…å›ºå®šï¼‰

### 7.1 groupby

* key = `product_code`

### 7.2 SKUåˆç®—ã™ã‚‹ã‚‚ã®

* stock_sum
* sales_units_m / lm
* sales_amount_m / lm
* profit_m / lm

### 7.3 ä»£è¡¨å€¤ï¼ˆå…ˆé ­éç©ºï¼‰ã‚’æ¡ç”¨ã™ã‚‹ã‚‚ã®

* access_m / lm
* cv_m / lm
* bounce_m / lm
* stay_m / lm
* fav_*
* reviews_total

### 7.4 ä»£è¡¨SKU

* ä»Šæœˆå£²ä¸Šå€‹æ•°ãŒæœ€å¤§ã®SKU
* å…¨ã¦0/ç©ºãªã‚‰å…ˆé ­SKU

### 7.5 åˆ©ç›Šç‡ç³»

* min_setting_margin = SKUæœ€å°
* max_setting_margin = SKUæœ€å¤§

---

## 8. ä¸€è¦§ç”»é¢ä»•æ§˜ï¼ˆç¢ºå®šï¼‰

### è¡¨ç¤ºåˆ—

1. å•†å“ç®¡ç†ç•ªå·
2. ä»£è¡¨SKU
3. å•†å“è©•ä¾¡ï¼ˆç·¨é›†å¯ï¼‰
4. å•†å“å
5. åœ¨åº«æ•°ï¼ˆåˆç®—ï¼‰
6. ä»Šæœˆå£²ä¸Šå€‹æ•°
7. ä»Šæœˆã‚¢ã‚¯ã‚»ã‚¹äººæ•°
8. ä»Šæœˆè»¢æ›ç‡
9. ãƒãƒƒã‚¸

### ãƒãƒƒã‚¸è¡¨ç¤ºãƒ«ãƒ¼ãƒ«

* æœ€å¤§3ã¤è¡¨ç¤º
* æ®‹ã‚Šã¯ã€Œ+nã€

---

## 9. è©³ç´°ç”»é¢ä»•æ§˜

### 9.1 å…ˆæœˆ vs ä»Šæœˆæ¯”è¼ƒï¼ˆæœ€é‡è¦ï¼‰

* å£²ä¸Š
* åˆ©ç›Š
* å£²ä¸Šå€‹æ•°
* åˆ©ç›Šç‡
* æ–°è¦/ãƒªãƒ”æ¯”ç‡
* ã‚¢ã‚¯ã‚»ã‚¹
* CV
* ãŠæ°—ã«å…¥ã‚Š
* ãƒ¬ãƒ“ãƒ¥ãƒ¼

### 9.2 SKUå†…è¨³ãƒ†ãƒ¼ãƒ–ãƒ«

* SKU
* åœ¨åº«
* ä»Šæœˆå£²ä¸Šå€‹æ•°
* åˆ©ç›Šç‡

### 9.3 ç·¨é›†

* å•†å“è©•ä¾¡
* ãƒ¡ãƒ¢
* ä¿å­˜ãƒœã‚¿ãƒ³ï¼ˆæ¥½è¦³æ›´æ–°ï¼‰

---

## 10. åˆ©ç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆå®Ÿè£…ï¼‰

### å…¥åŠ›

* è²©å£²ä¾¡æ ¼ï¼ˆç¨è¾¼ï¼‰
* é…é€ç¨®åˆ¥
* ä»•å…¥ã‚Œå€¤ï¼ˆç¨æŠœï¼‰
* ãƒã‚¤ãƒ³ãƒˆå€ç‡
* ã‚¯ãƒ¼ãƒãƒ³ï¼ˆç¨è¾¼å††ï¼‰

### è¨ˆç®—å¼ï¼ˆå›ºå®šï¼‰

```
netInTax = priceInTax * (1 - feeRate - pointRate) - couponInTax
netExTax = (netInTax - shippingCostInTax) / (1 + taxRate)
profitExTax = netExTax - costExTax
margin = profitExTax / (priceInTax / (1 + taxRate))
```

---

## 11. GAS å®Ÿè£…è¦ä»¶

* cacheç”Ÿæˆã¯ **å…¨ç½®æ›**
* setValuesä¸€æ‹¬æ›¸ãè¾¼ã¿
* æ•°å€¤æ­£è¦åŒ–å¿…é ˆï¼ˆÂ¥ % é™¤å»ï¼‰
* rawã¯èª­å–ã‚Šå°‚ç”¨

---

## 12. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹ï¼ˆTypeScriptï¼‰

ï¼ˆâ€»å®Ÿè£…è€…ã¯ã“ã®å‹ã‚’åŸºæº–ã«UIã‚’ä½œã‚‹ï¼‰

```ts
export interface ProductSummary {
  product_code: string;
  representative_sku: string;
  // å•†å“è©•ä¾¡ï¼ˆé‹ç”¨è©•ä¾¡ï¼‰ï¼šS/A/B/C/D/E
  rating: "S" | "A" | "B" | "C" | "D" | "E" | null;
  product_name: string;
  stock_sum: number;
  sales_units_m: number;
  access_m: number;
  cv_m: number;
  badges: string[];
}
```

---

## 13. å°†æ¥æ‹¡å¼µã‚’è¦‹æ®ãˆãŸè¨­è¨ˆãƒã‚¤ãƒ³ãƒˆ

* ãƒãƒƒã‚¸æ¡ä»¶ã¯ settings ã§å¯å¤‰
* åˆ©ç›Šè¨ˆç®—å¼ã‚‚ settings åŒ–å¯èƒ½
* è¤‡æ•°åº—èˆ—å¯¾å¿œï¼šrawã‚·ãƒ¼ãƒˆåˆ†é›¢ã§å¯¾å¿œå¯èƒ½
* BIãƒ„ãƒ¼ãƒ«æ¥ç¶šï¼šcacheã‚’ãã®ã¾ã¾ä½¿ãˆã‚‹

---

## 14. æœ€çµ‚ã¾ã¨ã‚

ã“ã®è¨­è¨ˆã¯

* **ãƒ‡ãƒ¼ã‚¿ã®ç™–ã‚’æ­£ã—ãç†è§£ã—ãŸã†ãˆã§**
* **äººãŒåˆ¤æ–­ã—ã‚„ã™ã„ç²’åº¦ã«è½ã¨ã—**
* **Sheet + GAS ã¨ã„ã†åˆ¶ç´„ä¸‹ã§æœ€å¤§ã®åŠ¹æœ**ã‚’å‡ºã™

ã“ã¨ã‚’ç›®çš„ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

---
